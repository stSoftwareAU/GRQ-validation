<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GRQ Stock Prediction Validation</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        .content {
            padding: 30px;
        }
        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            align-items: center;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .control-group label {
            font-weight: 600;
            color: #333;
        }
        select, input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .stat-card h3 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .stat-card .value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }
        .stat-card .subtitle {
            font-size: 0.8em;
            color: #666;
            margin-top: 5px;
        }
        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 30px;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        .error {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
            border-left: 4px solid #c33;
        }
        .no-data {
            background: #f0f8ff;
            color: #0066cc;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
            border-left: 4px solid #0066cc;
        }
        .stock-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .stock-table th,
        .stock-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        .stock-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }
        .stock-table tr:hover {
            background: #f8f9fa;
        }
        .performance-positive {
            color: #28a745;
            font-weight: bold;
        }
        .performance-negative {
            color: #dc3545;
            font-weight: bold;
        }
        .performance-neutral {
            color: #6c757d;
        }
        .clickable-stock {
            cursor: pointer;
            color: #007bff;
            text-decoration: underline;
            transition: color 0.2s;
        }
        .clickable-stock:hover {
            color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>GRQ Validation Dashboard</h1>
            <p>Validating AI predictions against 90-day targets and 10% annual cost of capital</p>
        </div>
        
        <div class="content">
            <div class="controls">
                <label for="scoreFileSelect">Score File:</label>
                <select id="scoreFileSelect">
                    <option value="">Select a score file...</option>
                </select>
            </div>

            <div id="loading" class="loading">
                Loading data...
            </div>

            <div id="error" class="error" style="display: none;"></div>
            <div id="noData" class="no-data" style="display: none;">
                No market data available yet for this score file. Data will appear as it becomes available.
            </div>

            <div id="summary" style="display: none;">
                <div class="summary-stats">
                    <div class="stat-card">
                        <h3>Days Elapsed</h3>
                        <div class="value" id="daysElapsed">-</div>
                    </div>
                    <div class="stat-card">
                        <h3>Stocks Tracked</h3>
                        <div class="value" id="stocksTracked">-</div>
                    </div>
                    <div class="stat-card">
                        <h3>Average Performance</h3>
                        <div class="value" id="avgPerformance">-</div>
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="performanceChart"></canvas>
                </div>

                <div id="stockDetails">
                    <h3>Individual Stock Performance</h3>
                    <table class="stock-table" id="stockTable">
                        <thead>
                            <tr>
                                <th>Stock</th>
                                <th>Buy Price</th>
                                <th>90-Day Target</th>
                                <th>Current Price</th>
                                <th>Gain/Loss (%)</th>
                                <th>Progress vs Cost of Capital</th>
                                <th>Judgement (90-day)</th>
                            </tr>
                        </thead>
                        <tbody id="stockTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        class GRQValidator {
            constructor() {
                this.scoreData = [];
                this.marketData = {};
                this.costOfCapital = 10; // 10% annual cost of capital
                this.selectedFile = '';
                this.filteredStocks = [];
                this.chart = null;
                
                this.init();
            }

            async init() {
                await this.loadIndex();
                this.setupEventListeners();
            }

            setupEventListeners() {
                document.getElementById('scoreFileSelect').addEventListener('change', (e) => {
                    this.selectedFile = e.target.value;
                    this.loadScoreFile();
                });
            }

            async loadIndex() {
                try {
                    // Add cache-busting parameter to force fresh fetch
                    const timestamp = new Date().getTime();
                    const response = await fetch(`scores/index.json?t=${timestamp}`);
                    const indexData = await response.json();
                    
                    const select = document.getElementById('scoreFileSelect');
                    select.innerHTML = '';
                    
                    indexData.scores.forEach(score => {
                        const option = document.createElement('option');
                        option.value = score.file;
                        option.textContent = `${score.date} (${score.month} ${score.day})`;
                        select.appendChild(option);
                    });

                    if (indexData.scores.length > 0) {
                        this.selectedFile = indexData.scores[0].file;
                        select.value = this.selectedFile;
                        await this.loadScoreFile();
                    }
                } catch (error) {
                    this.showError('Failed to load score files: ' + error.message);
                }
            }

            async loadScoreFile() {
                this.showLoading();
                
                try {
                    await this.loadScoreData();
                    await this.loadMarketData();
                    this.updateDisplay();
                } catch (error) {
                    this.showError('Failed to load data: ' + error.message);
                }
            }

            async loadScoreData() {
                // Add cache-busting parameter
                const timestamp = new Date().getTime();
                const response = await fetch(`scores/${this.selectedFile}?t=${timestamp}`);
                const text = await response.text();
                
                const lines = text.trim().split('\n');
                const headers = lines[0].split('\t');
                
                this.scoreData = lines.slice(1).map(line => {
                    const values = line.split('\t');
                    return {
                        stock: values[0],
                        score: parseFloat(values[1]),
                        target: parseFloat(values[2])
                    };
                });
                
                // Initialize filtered stocks
                this.filteredStocks = [...this.scoreData];
            }

            async loadMarketData() {
                const csvFile = this.selectedFile.replace('.tsv', '.csv');
                
                try {
                    // Add cache-busting parameter
                    const timestamp = new Date().getTime();
                    const response = await fetch(`scores/${csvFile}?t=${timestamp}`);
                    const text = await response.text();
                    
                    if (!text.trim()) {
                        this.marketData = null;
                        return;
                    }
                    
                    const lines = text.split('\n').filter(line => line.trim());
                    const headers = lines[0].split(',');
                    
                    this.marketData = {};
                    
                    lines.slice(1).forEach(line => {
                        const values = line.split(',');
                        const date = values[0];
                        const ticker = values[1];
                        const high = parseFloat(values[2]);
                        const low = parseFloat(values[3]);
                        const open = parseFloat(values[4]);
                        const close = parseFloat(values[5]);
                        
                        if (!this.marketData[ticker]) {
                            this.marketData[ticker] = [];
                        }
                        
                        this.marketData[ticker].push({
                            date: new Date(date),
                            high,
                            low,
                            open,
                            close
                        });
                    });
                } catch (error) {
                    console.warn('No market data available yet:', error.message);
                    this.marketData = null;
                }
            }

            updateDisplay() {
                if (!this.scoreData) {
                    this.showError('No score data available');
                    return;
                }

                if (!this.marketData || Object.keys(this.marketData).length === 0) {
                    this.showNoData();
                    return;
                }

                this.hideMessages();
                this.updateSummaryStats();
                this.updateStockTable();
                this.updateChart();
            }

            updateSummaryStats() {
                // Extract date from file path (e.g., "2025/March/21.tsv" -> "2025-03-21")
                const pathParts = this.selectedFile.split('/');
                const year = pathParts[0];
                const month = pathParts[1];
                const day = pathParts[2].replace('.tsv', '');
                
                // Convert month name to number
                const monthMap = {
                    'January': '01', 'February': '02', 'March': '03', 'April': '04',
                    'May': '05', 'June': '06', 'July': '07', 'August': '08',
                    'September': '09', 'October': '10', 'November': '11', 'December': '12'
                };
                
                const scoreDateStr = `${year}-${monthMap[month]}-${day.padStart(2, '0')}`;
                const scoreDate = new Date(scoreDateStr);
                const today = new Date();
                const daysElapsed = Math.floor((today - scoreDate) / (1000 * 60 * 60 * 24));

                // Calculate 90-day cost of capital equivalent
                const costOfCapital90Days = (Math.pow(1 + this.costOfCapital / 100, 90 / 365) - 1) * 100;

                // Calculate average performance
                let totalGain = 0;
                let validStocks = 0;
                
                this.scoreData.forEach(stock => {
                    const marketData = this.marketData[stock.stock];
                    if (marketData && marketData.length > 0) {
                        const initialPrice = marketData[0].high;
                        const currentPrice = marketData[marketData.length - 1].close;
                        const gain = ((currentPrice - initialPrice) / initialPrice) * 100;
                        totalGain += gain;
                        validStocks++;
                    }
                });

                const currentPerformance = validStocks > 0 ? totalGain / validStocks : 0;

                document.getElementById('daysElapsed').textContent = daysElapsed;
                document.getElementById('stocksTracked').textContent = this.scoreData.length;
                document.getElementById('avgPerformance').textContent = currentPerformance.toFixed(2) + '%';

                // Color coding
                const currentEl = document.getElementById('avgPerformance');
                if (currentPerformance > costOfCapital90Days) {
                    currentEl.className = 'value performance-positive';
                } else if (currentPerformance < 0) {
                    currentEl.className = 'value performance-negative';
                } else {
                    currentEl.className = 'value performance-neutral';
                }
            }

            updateChart() {
                const ctx = document.getElementById('performanceChart').getContext('2d');
                
                // Destroy existing chart if it exists
                if (this.chart) {
                    this.chart.destroy();
                }

                // Prepare data for chart
                const chartData = this.prepareChartData();
                
                if (chartData.labels.length === 0) {
                    return;
                }

                this.chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: chartData.labels,
                        datasets: chartData.datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Date'
                                },
                                ticks: {
                                    callback: function(value, index) {
                                        const label = this.getLabelForValue(value);
                                        return label || '';
                                    }
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Performance (%)'
                                },
                                ticks: {
                                    callback: function(value) {
                                        return value.toFixed(1) + '%';
                                    }
                                }
                            }
                        },
                        plugins: {
                            title: {
                                display: true,
                                text: 'Portfolio Performance vs 90-Day AI Targets'
                            },
                            legend: {
                                display: true,
                                position: 'top'
                            },
                            tooltip: {
                                callbacks: {
                                    title: function(context) {
                                        const index = context[0].dataIndex;
                                        const sortedDates = Array.from(new Set(
                                            context[0].dataset.data.map((_, i) => i)
                                        )).sort();
                                        const date = new Date(sortedDates[index]);
                                        return date.toLocaleDateString('en-US', { 
                                            weekday: 'short',
                                            month: 'short', 
                                            day: 'numeric',
                                            year: 'numeric'
                                        });
                                    }
                                }
                            }
                        }
                    }
                });
            }

            prepareChartData() {
                const labels = [];
                const datasets = [];

                // Get all unique dates from market data
                const allDates = new Set();
                this.filteredStocks.forEach(stock => {
                    const marketData = this.marketData[stock.stock];
                    if (marketData) {
                        marketData.forEach(entry => {
                            allDates.add(entry.date.toISOString().split('T')[0]); // Convert to YYYY-MM-DD string
                        });
                    }
                });

                // Sort dates
                const sortedDates = Array.from(allDates).sort();
                
                // Format dates for display (show every 7th date to avoid crowding)
                const formattedLabels = sortedDates.map((date, index) => {
                    if (index % 7 === 0 || index === sortedDates.length - 1) {
                        const dateObj = new Date(date);
                        return dateObj.toLocaleDateString('en-US', { 
                            month: 'short', 
                            day: 'numeric' 
                        });
                    }
                    return '';
                });
                
                labels.push(...formattedLabels);

                // Calculate aggregated portfolio performance
                const portfolioData = [];
                const portfolioDataAfter90 = []; // Separate data for after 90 days

                sortedDates.forEach((date, index) => {
                    let totalGain = 0;
                    let validStocks = 0;

                    this.filteredStocks.forEach(stock => {
                        const marketData = this.marketData[stock.stock];
                        if (marketData) {
                            const entry = marketData.find(e => e.date.toISOString().split('T')[0] === date);
                            if (entry) {
                                const initialPrice = marketData[0].high;
                                const performance = ((entry.close - initialPrice) / initialPrice) * 100;
                                totalGain += performance;
                                validStocks++;
                            }
                        }
                    });

                    const avgPerformance = validStocks > 0 ? totalGain / validStocks : null;
                    
                    // Check if this is after 90 days
                    const daysElapsed = this.getDaysElapsedFromDate(date);
                    if (daysElapsed <= 90) {
                        portfolioData.push(avgPerformance);
                        portfolioDataAfter90.push(null);
                    } else {
                        portfolioData.push(null);
                        portfolioDataAfter90.push(avgPerformance);
                    }
                });

                // Create portfolio dataset (before 90 days)
                datasets.push({
                    label: this.filteredStocks.length === this.scoreData.length ? 
                           'Portfolio Performance' : 
                           `Filtered Stocks (${this.filteredStocks.length})`,
                    data: portfolioData,
                    borderColor: '#36A2EB',
                    backgroundColor: '#36A2EB20',
                    borderWidth: 3,
                    fill: false,
                    tension: 0.1,
                    pointRadius: 3,
                    pointHoverRadius: 5
                });

                // Create portfolio dataset (after 90 days - grayed out)
                datasets.push({
                    label: 'Portfolio Performance (After 90 days)',
                    data: portfolioDataAfter90,
                    borderColor: '#999999',
                    backgroundColor: '#99999920',
                    borderWidth: 2,
                    fill: false,
                    tension: 0.1,
                    pointRadius: 2,
                    pointHoverRadius: 4
                });

                // Add 90-day target line
                const targetData = sortedDates.map((date, index) => {
                    const daysElapsed = this.getDaysElapsedFromDate(date);
                    if (daysElapsed <= 90) {
                        // Calculate average target performance at 90 days
                        let totalTargetGain = 0;
                        let validTargets = 0;
                        
                        this.filteredStocks.forEach(stock => {
                            const marketData = this.marketData[stock.stock];
                            if (marketData && marketData.length > 0) {
                                const initialPrice = marketData[0].high;
                                const targetPrice = stock.target;
                                const targetGain = ((targetPrice - initialPrice) / initialPrice) * 100;
                                totalTargetGain += targetGain;
                                validTargets++;
                            }
                        });
                        
                        const avgTargetGain = validTargets > 0 ? totalTargetGain / validTargets : 0;
                        return avgTargetGain;
                    }
                    return null;
                });

                datasets.push({
                    label: '90-Day AI Target',
                    data: targetData,
                    borderColor: '#FFA500',
                    backgroundColor: '#FFA50020',
                    borderWidth: 2,
                    fill: false,
                    borderDash: [3, 3],
                    tension: 0.1,
                    pointRadius: 0
                });

                // Add cost of capital reference line
                const costOfCapitalData = sortedDates.map((date, index) => {
                    const daysElapsed = this.getDaysElapsedFromDate(date);
                    return (Math.pow(1 + this.costOfCapital / 100, daysElapsed / 365) - 1) * 100;
                });

                datasets.push({
                    label: 'Cost of Capital (10% annual)',
                    data: costOfCapitalData,
                    borderColor: '#FF6384',
                    backgroundColor: '#FF638420',
                    borderWidth: 2,
                    fill: false,
                    borderDash: [5, 5],
                    tension: 0.1,
                    pointRadius: 0
                });

                // Add 90-day marker line
                const daysElapsed = this.getDaysElapsed();
                if (daysElapsed >= 90) {
                    const markerData = sortedDates.map((date, index) => {
                        const daysFromStart = this.getDaysElapsedFromDate(date);
                        return daysFromStart === 90 ? 0 : null; // Only show at 90 days
                    });

                    datasets.push({
                        label: '90-Day Mark',
                        data: markerData,
                        borderColor: '#FFA500',
                        backgroundColor: '#FFA500',
                        borderWidth: 3,
                        fill: false,
                        tension: 0,
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        pointStyle: 'circle'
                    });
                }

                return { labels, datasets };
            }

            getDaysElapsedFromDate(dateStr) {
                // Extract date from file path (e.g., "2025/March/21.tsv" -> "2025-03-21")
                const pathParts = this.selectedFile.split('/');
                const year = pathParts[0];
                const month = pathParts[1];
                const day = pathParts[2].replace('.tsv', '');
                
                // Convert month name to number
                const monthMap = {
                    'January': '01', 'February': '02', 'March': '03', 'April': '04',
                    'May': '05', 'June': '06', 'July': '07', 'August': '08',
                    'September': '09', 'October': '10', 'November': '11', 'December': '12'
                };
                
                const scoreDateStr = `${year}-${monthMap[month]}-${day.padStart(2, '0')}`;
                const scoreDate = new Date(scoreDateStr);
                const targetDate = new Date(dateStr);
                return Math.floor((targetDate - scoreDate) / (1000 * 60 * 60 * 24));
            }

            updateStockTable() {
                const tbody = document.getElementById('stockTableBody');
                tbody.innerHTML = '';

                // Calculate 90-day cost of capital
                const costOfCapital90Days = (Math.pow(1 + this.costOfCapital / 100, 90 / 365) - 1) * 100;

                this.filteredStocks.forEach(stock => {
                    const row = document.createElement('tr');
                    const marketData = this.marketData[stock.stock];
                    
                    if (marketData && marketData.length > 0) {
                        const initialPrice = marketData[0].high; // Buy at high on score date
                        const currentPrice = marketData[marketData.length - 1].close; // Use close for current price
                        const gain = ((currentPrice - initialPrice) / initialPrice) * 100;
                        
                        // Calculate progress vs cost of capital
                        const progressVsCostOfCapital = gain - costOfCapital90Days;
                        let progressText, progressClass;
                        
                        if (progressVsCostOfCapital >= 0) {
                            progressText = `+${progressVsCostOfCapital.toFixed(1)}%`;
                            progressClass = 'performance-positive';
                        } else {
                            progressText = `${progressVsCostOfCapital.toFixed(1)}%`;
                            progressClass = 'performance-negative';
                        }

                        // Calculate 90-day judgement
                        const daysElapsed = this.getDaysElapsed();
                        let judgementText, judgementClass;
                        
                        if (daysElapsed >= 90) {
                            // Find the price at or closest to 90 days
                            const targetDate = new Date(marketData[0].date);
                            targetDate.setDate(targetDate.getDate() + 90);
                            
                            const closestEntry = marketData.reduce((closest, entry) => {
                                const daysDiff = Math.abs((entry.date - marketData[0].date) / (1000 * 60 * 60 * 24) - 90);
                                const closestDaysDiff = Math.abs((closest.date - marketData[0].date) / (1000 * 60 * 60 * 24) - 90);
                                return daysDiff < closestDaysDiff ? entry : closest;
                            });
                            
                            const priceAt90Days = closestEntry.close;
                            const targetGain = ((stock.target - initialPrice) / initialPrice) * 100;
                            const actualGainAt90 = ((priceAt90Days - initialPrice) / initialPrice) * 100;
                            
                            if (actualGainAt90 >= targetGain * 0.8) { // Within 20% of target
                                judgementText = 'Hit Target';
                                judgementClass = 'performance-positive';
                            } else if (actualGainAt90 > 0) {
                                judgementText = 'Partial Success';
                                judgementClass = 'performance-neutral';
                            } else {
                                judgementText = 'Missed Target';
                                judgementClass = 'performance-negative';
                            }
                        } else {
                            judgementText = `Pending (${90 - daysElapsed} days left)`;
                            judgementClass = 'performance-neutral';
                        }

                        row.innerHTML = `
                            <td><strong class="clickable-stock" data-stock="${stock.stock}">${stock.stock}</strong></td>
                            <td>$${initialPrice.toFixed(2)}</td>
                            <td>$${stock.target.toFixed(2)}</td>
                            <td>$${currentPrice.toFixed(2)}</td>
                            <td class="${gain >= 0 ? 'performance-positive' : 'performance-negative'}">${gain.toFixed(2)}%</td>
                            <td class="${progressClass}">${progressText}</td>
                            <td class="${judgementClass}">${judgementText}</td>
                        `;
                    } else {
                        row.innerHTML = `
                            <td><strong class="clickable-stock" data-stock="${stock.stock}">${stock.stock}</strong></td>
                            <td>No data</td>
                            <td>$${stock.target.toFixed(2)}</td>
                            <td>No data</td>
                            <td>-</td>
                            <td>-</td>
                            <td>-</td>
                        `;
                    }

                    tbody.appendChild(row);
                });

                // Add click handlers for stock selection
                document.querySelectorAll('.clickable-stock').forEach(element => {
                    element.addEventListener('click', (e) => {
                        const stockSymbol = e.target.dataset.stock;
                        
                        if (this.filteredStocks.length === 1 && this.filteredStocks[0].stock === stockSymbol) {
                            // If only this stock is selected, show all stocks (portfolio)
                            this.filterStocks('');
                        } else {
                            // Select this specific stock
                            this.filterStocks(stockSymbol);
                        }
                    });
                });
            }

            showLoading() {
                document.getElementById('loading').style.display = 'block';
                document.getElementById('summary').style.display = 'none';
                document.getElementById('error').style.display = 'none';
                document.getElementById('noData').style.display = 'none';
            }

            showError(message) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('summary').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('noData').style.display = 'none';
                document.getElementById('error').textContent = message;
            }

            showNoData() {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('summary').style.display = 'none';
                document.getElementById('error').style.display = 'none';
                document.getElementById('noData').style.display = 'block';
            }

            hideMessages() {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'none';
                document.getElementById('noData').style.display = 'none';
                document.getElementById('summary').style.display = 'block';
            }

            getDaysElapsed() {
                // Extract date from file path (e.g., "2025/March/21.tsv" -> "2025-03-21")
                const pathParts = this.selectedFile.split('/');
                const year = pathParts[0];
                const month = pathParts[1];
                const day = pathParts[2].replace('.tsv', '');
                
                // Convert month name to number
                const monthMap = {
                    'January': '01', 'February': '02', 'March': '03', 'April': '04',
                    'May': '05', 'June': '06', 'July': '07', 'August': '08',
                    'September': '09', 'October': '10', 'November': '11', 'December': '12'
                };
                
                const scoreDateStr = `${year}-${monthMap[month]}-${day.padStart(2, '0')}`;
                const scoreDate = new Date(scoreDateStr);
                const today = new Date();
                return Math.floor((today - scoreDate) / (1000 * 60 * 60 * 24));
            }

            filterStocks(filter) {
                if (!filter.trim()) {
                    this.filteredStocks = [...this.scoreData];
                } else {
                    this.filteredStocks = this.scoreData.filter(stock => 
                        stock.stock.toLowerCase().includes(filter.toLowerCase())
                    );
                }
                this.updateStockTable();
                this.updateChart();
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            new GRQValidator();
        });
    </script>
</body>
</html> 